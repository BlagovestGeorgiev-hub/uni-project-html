<!DOCTYPE html>
<html>
	<head>
		<title>Game Cubes</title>
		<meta charset="utf-8">
		<style>
			.front{
				width: 450px;
				height: 580px;
				margin: auto;
				border: 1px solid black;
			}
			h1{
				color: DodgerBlue;
				margin: 5px;
				text-align: center;
			}
			.box{
				margin: 0px 10px;
				/*border: 1px solid black;*/
				width: 250px;
			}
			.box div{
				border: 1px solid black;
				border-radius: 5px;
				width: 30px; 
				height: 30px;
				background: #fee55e;
				text-align: center;
				font-size: 24px;
				float: left;
				cursor: pointer;
				padding: 15px;
			}
			button{
				margin: 10px 25px;
				font-size: 20px;
				border: 2px outset #d3d7cf;
				border-radius: 10px;
			}
			#b0{
				background: white;
			}
			.time{
				width: 95px;
				margin: 10px 30px;
				text-align: center;
				font-size: 20px;
				border: 1px solid black;
				float: left;
				color: #39FF14;
			}
			.cover{
				font-size: 20px;
				text-align: center;
				color: #39FF14;
			}
			.cover img{
				margin: 10px;
				width: 40px; 
				height: 40px;
			}
			.cover img:hover{
				transform: scale(5, 5);
				transition: transform 3s;
			}
			.recordi{
				margin: 10px;
				border: 1px solid black;
				background-repeat: no-repeat;
				width: 190px; 
				height: 251px;
				text-align: center;
				float: left;
			}
			.recordi span{
				width: 120px;
				margin: 15px 0px -10px 35px;
				text-align: center;
				font-size: 12px;
				color: #39FF14;
				/*border: 1px solid black;*/
				float: left;
			}
		</style>
		<script>
			function mouseDown(x){
				document.getElementById(x).style.backgroundColor = "#a2a29f";
				document.getElementById(x).style.border = "2px inset #828280";
				document.getElementById(x).style.fontSize = "20px";
				document.getElementById(x).style.borderRadius = "10px";
			}
			function mouseUp(x){
				document.getElementById(x).style.backgroundColor = "#e8e8e7";
				document.getElementById(x).style.border = "2px outset #d3d7cf";
				document.getElementById(x).style.fontsize = "20px";
				document.getElementById(x).style.borderRadius = "10px";
			}
			
			var allbox = new Array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15);
			var len = allbox.length;
			
			function shuffle(){
				for(i = 0; i < len; i++){
					var rand = Math.floor(Math.random()* len);
					var temp = allbox[i];
					allbox[i] = allbox[rand];
					allbox[rand] = temp;
				}
			}
			function mix(){
				shuffle();
				for(i = 0; i < len; i++){
					if(!(allbox[i]==0)){
						document.getElementById("b" + i).innerHTML = allbox[i];
						document.getElementById("b" + i).style.backgroundColor = "#fee55e";
						document.getElementById("b" + i).id = "b" + allbox[i];
					}
					else{
						document.getElementById("b" + i).innerHTML = "";
						document.getElementById("b" + i).style.backgroundColor = "white";
						document.getElementById("b" + i).id = "b" + allbox[i];
					}
				}
			}
			function restart(){
				game_started = true;
				let children = document.getElementsByClassName("box")[0].children;
				for(let i = 0; i < children.length - 1; i++){
					children[i].innerHTML = i + 1 ;
					children[i].id = "b" + (i + 1);
					children[i].style.backgroundColor = "#fee55e";
				}
				children[children.length - 1].innerHTML = "";
				children[children.length - 1].id ="b0";
				children[children.length - 1].style.backgroundColor = "white";
				start_game();
			}
			let already_clicked_id = null;
			let game_started = false;
			function start_end_exchange(el_id){
				if ((already_clicked_id === null && el_id!== "b0")){
					return;
				}
				if (!game_started){
					return;
				}
				if (already_clicked_id === null){
					already_clicked_id = el_id;
					document.getElementById(already_clicked_id).style.background = 'green';
					return;
				}
				
				let first_clicked_position = -1;
				let second_clicked_postition = -1;
				let children = document.getElementsByClassName("box")[0].children;
				for(let i = 0; i < children.length; i++){
					if(already_clicked_id === children[i].id){
						first_clicked_position = i;
					}
					if(el_id === children[i].id){
						second_clicked_postition = i;
					}
				}
				let correct_clicked_postition = true;
				if((first_clicked_position === second_clicked_postition - 1) && (!([3, 7, 11]).includes(first_clicked_position)) ||
					((first_clicked_position === second_clicked_postition + 1) && (!([4, 8, 12]).includes(first_clicked_position))) ||
					(first_clicked_position + 4 === second_clicked_postition || first_clicked_position - 4 == second_clicked_postition)){
					let right = document.getElementsByClassName("box")[0].children[second_clicked_postition];
					let left = document.getElementsByClassName("box")[0].children[first_clicked_position];
					replace_two_divs(left, right);
				}
				document.getElementById(already_clicked_id).style.background = "#fee55e";
				if(already_clicked_id === "b0"){
					document.getElementById(already_clicked_id).style.background = "white";
				}
				already_clicked_id = null;
				check_if_game_is_finished();
			}
			
			function replace_two_divs(first, second){
				let temp = document.createElement('div');
				let nodes=[], values=[];
				for (let att, i = 0, atts = first.attributes, n = atts.length; i < n; i++){
					att = atts[i];
					nodes.push(att.nodeName);
					values.push(att.nodeValue);
					temp.setAttribute(att.nodeName,att.nodeValue);
				}
				temp.innerHTML = first.innerHTML;
				first.innerHTML = second.innerHTML;
				first.id = second.id;
				first.style.backgroundColor = second.style.backgroundColor;
				second.innerHTML = temp.innerHTML;
				second.id = temp.id;
				second.style.backgroundColor = temp.style.backgroundColor;
			}
			let interval = null;
			function start_game(){
				mix();
				game_started = true;
				clearInterval(interval);
				document.getElementById("time").innerHTML = "00:00:00";
				seconds = 0;
				minutes = 0;
				hours = 0;
				interval = setInterval(timer_start,1000);
			}
			let seconds = 0;
			let minutes = 0;
			let hours = 0;
			let timer = null;
			function timer_start(){
				let output_seconds = "";
				let output_minutes = "";
				let output_hours = "";
				if(seconds === 60){
					seconds = 0;
					minutes += 1;
				}
				if(minutes === 60){
					minutes = 0;
					hours += 1;
				}
				if(seconds < 10){
					output_seconds = "0" + seconds;
				}else{
					output_seconds = seconds;
				}
				if(minutes < 10){
					output_minutes = "0" + minutes;
				}else{
					output_minutes = minutes;
				}
				if(hours < 10){
					output_hours = "0" + hours;
				}else{
					output_hours = hours;
				}
				timer = output_hours + ":" + output_minutes + ":" + output_seconds;
				document.getElementById("time").innerHTML = timer;
				seconds++;
			}
			function check_if_game_is_finished(){
				let children = document.getElementsByClassName("box")[0].children;
				let children_id = [];
				let zero_first = true;
				let zero_last = true;
				for (let i = 0; i < children.length; i++){
					children_id.push(children[i].id.replace( /^\D+/g, ''));
					if (parseInt(children_id[i]) !== i){
						zero_first = false;
					}
				}
				for (let i = 1; i < children.length; i++){
					if (parseInt(children_id[i - 1]) !== i){
						zero_last = false;
					}
				}
				if (zero_first){
					let person = prompt("Запиши ме като: "," ");
					if(person!=null){
						let person_with_score = person + " с време " + timer;
						localStorage.setItem(("" + person), ("" + JSON.stringify(person_with_score)));
						display_records();
						start_game();
					}
				}
			}
			let index = 0;
			function display_records(){
				let records_container = document.getElementsByClassName("recordi")[0];
				records_container.innerHTML = "";
				for (let key = 0; key < localStorage.length; key++) {
					let next_record = document.createElement("span");
					next_record.id = (index++) + localStorage.key(key);
					next_record.innerHTML =localStorage.getItem(localStorage.key(key));
					records_container.appendChild(next_record);
				}
			}
			window.onload = display_records;
		</script>
	</head>
	<body>
		<div class = "front">
			<h1>Game Cubes</h1>
			<div class = "box">
				<div id=b1 onClick="start_end_exchange(this.id)">1</div>
				<div id=b2 onClick="start_end_exchange(this.id)">2</div>
				<div id=b3 onClick="start_end_exchange(this.id)">3</div>
				<div id=b4 onClick="start_end_exchange(this.id)">4</div>
				<div id=b5 onClick="start_end_exchange(this.id)">5</div>
				<div id=b6 onClick="start_end_exchange(this.id)">6</div>
				<div id=b7 onClick="start_end_exchange(this.id)">7</div>
				<div id=b8 onClick="start_end_exchange(this.id)">8</div>
				<div id=b9 onClick="start_end_exchange(this.id)">9</div>
				<div id=b10 onClick="start_end_exchange(this.id)">10</div>
				<div id=b11 onClick="start_end_exchange(this.id)">11</div>
				<div id=b12 onClick="start_end_exchange(this.id)">12</div>
				<div id=b13 onClick="start_end_exchange(this.id)">13</div>
				<div id=b14 onClick="start_end_exchange(this.id)">14</div>
				<div id=b15 onClick="start_end_exchange(this.id)">15</div>
				<div id=b0 onClick="start_end_exchange(this.id)"> </div>
			</div>
			<button id= "buttonStart" onclick="start_game()" onmousedown="mouseDown(this.id)" onmouseup="mouseUp(this.id)"> Старт </button>
			<!--<button id = "buttonShuffle" onClick="mix()" onmousedown="mouseDown(this.id)" onmouseup="mouseUp(this.id)">Разбъркай</button>-->
			<button id = "buttonRestart" onmousedown="mouseDown(this.id)" onmouseup="mouseUp(this.id)" onClick="restart()">Рестарт</button>
			<div class = "cover"> Решение: <img  src="cover.png" alt="cover">  </div>
			<div class="time">Брояч: <span id="time">00:00:00</span></div>
			<div class="recordi"> Рекорди:</div>
		</div>
	</body>
</html>
